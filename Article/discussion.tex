\clearpage
\newpage



\section{Discussion}

Including geographic information on sample locations in the inference of ancestral relationships among  organisms is a major objective of population genetic studies (Mal\'ecot 1948, Cavalli-Sforza et al. 1994, Epperson 2003). Assuming that geographically close individuals are more likely to share ancestry than individuals at distant sites, we introduced two new  algorithms for estimating ancestry proportions using geographic information. Based on least-squares problems, the new algorithms combine matrix factorization approaches and spatial statistics to provide accurate estimates of individual ancestry coefficients and ancestral genotype frequencies. The two methods share many similarities, but they differ in the approximations they make in order to decrease the algorithmic complexity and  increase the converge rate.  More specifically, the AQP algorithm was based on quadratic programming, whereas the APLS algorithm was based on the spectral decomposition of the Laplacian matrix. The {\tt tess3} algorithm, which is based on a change of variables, applies more classical matrix factorization methods to some transformed data set. The algorithmic complexity of APLS algorithm grows linearly with the number of individuals in the sample while keeping the same accuracy as the other algorithms (the complexities are quadratic for AQP and {\tt tess3}). 


To measure the benefit of using spatial algorithms, we compared the statistical errors observed for spatial algorithms with those observed for non-spatial algorithms similar to the program {\tt structure}. The errors of spatial methods were lower than those observed  with non-spatial methods, and spatial algorithms allowed the detection of more subtle population structure. In addition, we implemented neutrality tests based on the spatial estimates of the $Q$ and $G$-matrices (Martins et al. 2016), and we observed that those tests had higher power to reject neutrality than those based on non-spatial approaches. Thus spatial information helped improving the detection of signatures of selective sweeps having occurred  in ancestral populations prior to the admixture or fusion events. We applied the neutrality tests to performing a genome scan for selection in European ecotypes of {\it A. thaliana}. The genome scan for selection provided additional evidence for selection at flowering-related genes {\it CIP4.1}, {\it FRI} and {\it SVP} differentiating Fennoscandia from North-West Europe (Horton et al. 2012), and revealed several other interesting candidates involved in biological functions.
 

Estimation of ancestry coefficients using fast algorithms that extend non-spatial approaches -- such as {\tt structure} -- has been intensively discussed during the last years (Wollstein and Lao 2015). In these improvements of computational speed, spatial approaches has received less attention than non-spatial approaches. In this study, we have proposed a conceptual framework for developing fast spatial ancestry estimation methods, and we have proposed a suite of computer programs that implement this framework in the {\tt R} program. Our {\tt R} package provides an integrated pipeline for estimating and visualizing population genetic structure,  and for scanning genomes for signature of local adaptation. The algorithmic complexity of our algorithms allow their users to analyze samples including hundreds to thousands of individuals. For example, analyzing more than one thousand {\it A. thaliana} genotypes, each including more than 200$k$ SNPs, took less than a few minutes using a single CPU. In addition, the algorithms have a multithreaded version, that can run on parallel computers by using multiple CPUs. The multithreaded algorithm, which is available from the {\tt R} program, allows using our programs in moderate and large-scale genomic sequencing projects. 

 
 
 



 























